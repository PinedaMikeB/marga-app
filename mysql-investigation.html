<!DOCTYPE html>
<html>
<head>
    <title>Check MySQL Branch ID Issue</title>
    <style>
        body { font-family: system-ui; padding: 20px; max-width: 900px; margin: 0 auto; }
        .info { background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .warning { background: #fff3e0; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #ff9800; }
        .error { background: #ffebee; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #f44336; }
        code { background: #f5f5f5; padding: 2px 6px; border-radius: 4px; }
        pre { background: #1e1e1e; color: #0f0; padding: 15px; border-radius: 8px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîç MySQL Branch ID Investigation</h1>
    
    <div class="error">
        <h3>‚ö†Ô∏è Problem Found</h3>
        <p>Contract 5258 references <code>contract_id = 4292</code></p>
        <p>Contract 5413 references <code>contract_id = 4447</code></p>
        <p>But <code>tbl_branchinfo</code> only has IDs up to <strong>3812</strong>!</p>
        <p>AUTO_INCREMENT is set to 3813, meaning no branch with ID > 3812 exists.</p>
    </div>

    <div class="warning">
        <h3>ü§î Questions for Mike</h3>
        <ol>
            <li>In your VB.NET app, when you VIEW invoice #125538, where does "China Bank Savings Inc- CCAD - Consumer Securities" come from?</li>
            <li>When you CREATE a new contract for a new department (like "Auto Loan 03120"), what dropdown/field do you use?</li>
            <li>Is the branch/department name typed manually or selected from a list?</li>
            <li>Run this SQL in phpMyAdmin:
                <pre>SELECT MAX(id) FROM tbl_branchinfo;
SELECT * FROM tbl_branchinfo WHERE id > 3800 ORDER BY id DESC LIMIT 20;</pre>
            </li>
        </ol>
    </div>

    <div class="info">
        <h3>üìä What we know from the MySQL dump (Jan 5, 2026)</h3>
        <ul>
            <li><code>tbl_branchinfo</code>: 3,336 records, max ID = 3812</li>
            <li><code>tbl_contractmain</code>: Contract 5258 has <code>contract_id=4292</code>, <code>department=''</code> (empty)</li>
            <li><code>tbl_contractmain</code>: Contract 5413 has <code>contract_id=4447</code>, <code>department=''</code> (empty)</li>
            <li>The <code>department</code> field in contracts is EMPTY for both</li>
        </ul>
    </div>

    <div class="info">
        <h3>üîß Possible Explanations</h3>
        <ol>
            <li><strong>contract_id doesn't reference tbl_branchinfo</strong> - It might reference a different table or be used for something else</li>
            <li><strong>Data entry bypass</strong> - New branches might be entered directly in contracts without creating a branch record first</li>
            <li><strong>Branch name is composed</strong> - The app might combine company name + department field at runtime</li>
        </ol>
    </div>

    <h2>üîç SQL Queries to Run</h2>
    <p>Please run these in phpMyAdmin and share the results:</p>
    
    <h3>1. Check max branch ID</h3>
    <pre>SELECT MAX(id) as max_id, COUNT(*) as total FROM tbl_branchinfo;</pre>
    
    <h3>2. Check if there are any branches > 3812</h3>
    <pre>SELECT * FROM tbl_branchinfo WHERE id > 3812 ORDER BY id;</pre>
    
    <h3>3. Check contract 5258's full data</h3>
    <pre>SELECT * FROM tbl_contractmain WHERE id = 5258;</pre>
    
    <h3>4. Check what contract_id 4292 is used for</h3>
    <pre>-- Check if 4292 appears in any branch table
SELECT 'tbl_branchinfo' as tbl, COUNT(*) FROM tbl_branchinfo WHERE id = 4292
UNION
SELECT 'as company_id', COUNT(*) FROM tbl_branchinfo WHERE company_id = 4292;</pre>
    
    <h3>5. How does your VB.NET app get the branch name?</h3>
    <p>Look at the SQL query your app uses when displaying invoice details. It might JOIN multiple tables.</p>

</body>
</html>
