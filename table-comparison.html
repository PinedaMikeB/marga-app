<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MySQL vs Firebase - Table Comparison</title>
    <style>
        body { font-family: system-ui; padding: 2rem; background: #f5f5f5; }
        .card { background: white; padding: 1.5rem; border-radius: 12px; margin-bottom: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        h1 { color: #1e3a5f; }
        .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin: 1rem 0; }
        .stat { background: #f1f5f9; padding: 1rem; border-radius: 8px; text-align: center; }
        .stat-value { font-size: 2rem; font-weight: bold; }
        .stat-value.green { color: #22c55e; }
        .stat-value.red { color: #ef4444; }
        .stat-value.blue { color: #3b82f6; }
        .stat-label { color: #64748b; font-size: 0.85rem; }
        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        th, td { padding: 0.5rem; text-align: left; border-bottom: 1px solid #e5e7eb; }
        th { background: #f1f5f9; font-weight: 600; position: sticky; top: 0; }
        .status-migrated { color: #22c55e; font-weight: bold; }
        .status-missing { color: #ef4444; }
        .status-partial { color: #f59e0b; }
        .table-container { max-height: 500px; overflow-y: auto; }
        .filter-btns { margin-bottom: 1rem; }
        .filter-btn { padding: 0.5rem 1rem; border: 1px solid #e5e7eb; background: white; cursor: pointer; margin-right: 0.5rem; border-radius: 6px; }
        .filter-btn.active { background: #2563eb; color: white; border-color: #2563eb; }
        .search-box { padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 6px; width: 300px; margin-bottom: 1rem; }
        .highlight { background: #fef3c7; }
    </style>
</head>
<body>
    <h1>üìä MySQL vs Firebase - Table Comparison</h1>
    
    <div class="card">
        <h2>Summary</h2>
        <div class="stats">
            <div class="stat">
                <div class="stat-value blue" id="totalMysql">235</div>
                <div class="stat-label">MySQL Tables</div>
            </div>
            <div class="stat">
                <div class="stat-value green" id="totalFirebase">0</div>
                <div class="stat-label">In Firebase</div>
            </div>
            <div class="stat">
                <div class="stat-value red" id="totalMissing">0</div>
                <div class="stat-label">Not Migrated</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="percentage">0%</div>
                <div class="stat-label">Complete</div>
            </div>
        </div>
    </div>

    <div class="card">
        <h2>Table Details</h2>
        <input type="text" class="search-box" placeholder="Search tables..." onkeyup="filterTables(this.value)">
        <div class="filter-btns">
            <button class="filter-btn active" onclick="setFilter('all')">All</button>
            <button class="filter-btn" onclick="setFilter('migrated')">‚úÖ Migrated</button>
            <button class="filter-btn" onclick="setFilter('missing')">‚ùå Not Migrated</button>
            <button class="filter-btn" onclick="setFilter('important')">‚≠ê Important</button>
        </div>
        <div class="table-container">
            <table id="tableList">
                <thead>
                    <tr>
                        <th>Table Name</th>
                        <th>Status</th>
                        <th>Firebase Records</th>
                        <th>Priority</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <tr><td colspan="4">Loading...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="shared/js/firebase-config.js"></script>
    <script>
        if (!firebase.apps.length) firebase.initializeApp(FIREBASE_CONFIG);
        const db = firebase.firestore();

        // All MySQL tables from the dump
        const mysqlTables = [
            'account', 'local_firebase_sync', 'system_rules', 'tbl_Junk', 'tbl_accountingreport',
            'tbl_accountschart', 'tbl_adjusteddays', 'tbl_adminreqdesc', 'tbl_adminreqtype',
            'tbl_adminrequest', 'tbl_adminrequestdetails', 'tbl_area', 'tbl_assemblytracking',
            'tbl_autodeductions', 'tbl_backupmachinereading', 'tbl_batchparts', 'tbl_beginningbalance',
            'tbl_bgroup', 'tbl_billinfo', 'tbl_billing', 'tbl_billingsearch', 'tbl_biologstatus',
            'tbl_biouserinfo', 'tbl_biousers', 'tbl_bracket', 'tbl_branchaddtemp', 'tbl_branchcontact',
            'tbl_branchinfo', 'tbl_brand', 'tbl_callconversions', 'tbl_cameraarriane',
            'tbl_cancelledinvoices', 'tbl_canvassing', 'tbl_cartridge', 'tbl_cartridgemonitor',
            'tbl_cartridgemonitoring', 'tbl_cartridgeorder', 'tbl_cartridgepartshistory',
            'tbl_cartridgeprocorder', 'tbl_cartridgereceive', 'tbl_cartridgetonerhistory',
            'tbl_changeunitrequest', 'tbl_chat', 'tbl_checkmachine', 'tbl_checkpayments',
            'tbl_checktype', 'tbl_city', 'tbl_class', 'tbl_clientitemcosting', 'tbl_clientpaymentsummary',
            'tbl_clientservicecosting', 'tbl_closedref', 'tbl_closedscheds', 'tbl_cmodel',
            'tbl_collectionhistory', 'tbl_collectioninfo', 'tbl_collections', 'tbl_collectionstatus',
            'tbl_companylist', 'tbl_compcart', 'tbl_concartridge', 'tbl_condep', 'tbl_condition',
            'tbl_conparts', 'tbl_contractcon', 'tbl_contractdep', 'tbl_contractdetails',
            'tbl_contracthistory', 'tbl_contractinfo', 'tbl_contractmain', 'tbl_contractstatus',
            'tbl_coopcontribution', 'tbl_cooploan', 'tbl_cooploandeductions', 'tbl_costingmachineinfield',
            'tbl_crn', 'tbl_cstatus', 'tbl_customerinfo', 'tbl_customertype', 'tbl_cutoffperiod',
            'tbl_days', 'tbl_debitcredit', 'tbl_deductionexclusions', 'tbl_deliveryinfo',
            'tbl_depositslip', 'tbl_depositsliptransaction', 'tbl_dispatcheditems', 'tbl_dispatchment',
            'tbl_dr', 'tbl_dr_itemtype', 'tbl_drhistory', 'tbl_drmain', 'tbl_drorder', 'tbl_drstatus',
            'tbl_dstdetails', 'tbl_editinvoicehistory', 'tbl_employee', 'tbl_empos', 'tbl_empstatus',
            'tbl_emptycartridge', 'tbl_extension', 'tbl_facilitycheck', 'tbl_fftype', 'tbl_finaldr',
            'tbl_finaldrdetails', 'tbl_financereqdesc', 'tbl_financereqtype', 'tbl_financerequest',
            'tbl_financerequestdetails', 'tbl_fixtures', 'tbl_followup', 'tbl_followups',
            'tbl_forinvoice', 'tbl_forshutdown', 'tbl_forterminationrecords', 'tbl_fstatus',
            'tbl_groupings', 'tbl_groupsum', 'tbl_halfdaylog', 'tbl_incentivefactors', 'tbl_industry',
            'tbl_inkcolor', 'tbl_inquiries', 'tbl_inventoryparts', 'tbl_inventoryreceiving',
            'tbl_inventoryreceivingdetails', 'tbl_inventoryreq', 'tbl_invoiceage', 'tbl_invoicenum',
            'tbl_invoicerequest', 'tbl_irstatus', 'tbl_itemcat', 'tbl_itemprepared', 'tbl_itemreceived',
            'tbl_itemrequest', 'tbl_itemrequestdetails', 'tbl_itemstat', 'tbl_junkdetails',
            'tbl_leave', 'tbl_leavetype', 'tbl_login', 'tbl_machcartcomp', 'tbl_machine',
            'tbl_machinemonthlystatus', 'tbl_machineorder', 'tbl_machineparts', 'tbl_machinepickupreceipt',
            'tbl_machinereading', 'tbl_machinerepair', 'tbl_machinerequest', 'tbl_machineverifier',
            'tbl_mapinfo', 'tbl_margadep', 'tbl_maritalstatus', 'tbl_mcondition', 'tbl_mhfrecords',
            'tbl_mobileappusers', 'tbl_mobileappusersdetails', 'tbl_model', 'tbl_month', 'tbl_mstatus',
            'tbl_mtype', 'tbl_multipleinvoicecall', 'tbl_nature', 'tbl_newbankaccounts',
            'tbl_newcartridgehistory', 'tbl_newcartridgerepair', 'tbl_newcartridgestatus',
            'tbl_newchartofaccounts', 'tbl_newchartofaccountsforcv', 'tbl_newchecktype',
            'tbl_newcheckvoucher', 'tbl_newcheckvoucherdetails', 'tbl_newdepositslip',
            'tbl_newdepositslipdetails', 'tbl_newdr', 'tbl_newfordr', 'tbl_newmachinehistory',
            'tbl_newmachinerepair', 'tbl_newmachinerepairuseditems', 'tbl_newmachinestatus',
            'tbl_newotherrequest', 'tbl_newothershistory', 'tbl_newpartshistory', 'tbl_newpartsstatus',
            'tbl_newpettycash', 'tbl_newpo', 'tbl_newpodetails', 'tbl_newprogram', 'tbl_newreceiving',
            'tbl_newreplenishment', 'tbl_newrr', 'tbl_newrrdetails', 'tbl_newtonerinkhistory',
            'tbl_npcreports', 'tbl_origin', 'tbl_ornumber', 'tbl_otherdeddesc', 'tbl_otherdeductions',
            'tbl_otherpayto', 'tbl_others', 'tbl_overhauling', 'tbl_ownership', 'tbl_particular',
            'tbl_particulars', 'tbl_parts', 'tbl_partsstatus', 'tbl_partstaken', 'tbl_partstype',
            'tbl_partsused', 'tbl_payee', 'tbl_paymentcheck', 'tbl_paymentinfo', 'tbl_paymentrequest',
            'tbl_payments', 'tbl_paymenttype', 'tbl_payroll', 'tbl_payrolladjustments', 'tbl_payrolldtr',
            'tbl_payrolldtrmsgrtech', 'tbl_payto', 'tbl_paytotype', 'tbl_pcategory', 'tbl_pcbankaccounts',
            'tbl_pcdefaccounts', 'tbl_pcdetails', 'tbl_pcmain', 'tbl_pettycash', 'tbl_philhealth',
            'tbl_pird', 'tbl_pirdrequest', 'tbl_plocation', 'tbl_pmscheduling', 'tbl_porequest',
            'tbl_porequestdetails', 'tbl_prevmaintenance', 'tbl_printedscheds', 'tbl_prmachine',
            'tbl_program', 'tbl_prrequest', 'tbl_prrequestdetails', 'tbl_pstatus', 'tbl_purchasedetails',
            'tbl_purchaseorder', 'tbl_purchasereceived', 'tbl_purpose', 'tbl_quarter', 'tbl_rating',
            'tbl_rd', 'tbl_rdmodel', 'tbl_rdprocessrequest', 'tbl_rdtype', 'tbl_reading',
            'tbl_receiving', 'tbl_receivingdetails', 'tbl_refillitems', 'tbl_regularholidays',
            'tbl_releaseditem', 'tbl_releaseditems', 'tbl_releasing', 'tbl_repaircartridgecounter',
            'tbl_repairedparts', 'tbl_repairhistory', 'tbl_request', 'tbl_responsetime',
            'tbl_rtfreading', 'tbl_salesreport', 'tbl_savedscheds', 'tbl_schedtime', 'tbl_schedule',
            'tbl_scheduleorder', 'tbl_serviceinfo', 'tbl_shutdownactions', 'tbl_shutdownmachines',
            'tbl_specialholidays', 'tbl_sss', 'tbl_status', 'tbl_storage', 'tbl_storagehistory',
            'tbl_suppitem', 'tbl_supplier', 'tbl_supplierterms', 'tbl_sys', 'tbl_taxbracket',
            'tbl_taxcategory', 'tbl_techarea', 'tbl_techcomm', 'tbl_techincentives', 'tbl_temp',
            'tbl_tempbranches', 'tbl_tempdays', 'tbl_temporarycn', 'tbl_tempsched', 'tbl_terminated',
            'tbl_terminatedrecords', 'tbl_terminationrecords', 'tbl_test', 'tbl_timeadjustments',
            'tbl_timelog', 'tbl_tistatus', 'tbl_tonercount', 'tbl_tonerink', 'tbl_trouble',
            'tbl_ttype', 'tbl_turf', 'tbl_usercredentials', 'tbl_usertype', 'tbl_utot',
            'tbl_vouchertype', 'tbl_wyicustomerinfo', 'tbl_wyiinventory', 'tbl_wyiitemdescription',
            'tbl_wyiiteminfo', 'tbl_wyisupplierinfo', 'tbl_wyitshirtinfo', 'tbl_year'
        ];

        // Important tables for the app
        const importantTables = [
            'tbl_companylist', 'tbl_branchinfo', 'tbl_contractmain', 'tbl_machine', 'tbl_model',
            'tbl_brand', 'tbl_billinfo', 'tbl_billing', 'tbl_machinereading', 'tbl_collections',
            'tbl_particulars', 'tbl_area', 'tbl_city', 'tbl_contractstatus', 'tbl_newmachinestatus',
            'tbl_employee', 'tbl_serviceinfo', 'tbl_schedule', 'tbl_parts', 'tbl_cartridge',
            'tbl_invoicenum', 'tbl_condition', 'tbl_storage'
        ];

        let tableData = [];
        let currentFilter = 'all';

        async function checkFirebaseTables() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '<tr><td colspan="4">Checking Firebase...</td></tr>';
            
            let migrated = 0;
            let missing = 0;
            tableData = [];

            for (const table of mysqlTables) {
                let status = 'missing';
                let count = 0;
                
                try {
                    const snap = await db.collection(table).limit(1).get();
                    if (!snap.empty) {
                        status = 'migrated';
                        // Get approximate count
                        const countSnap = await db.collection(table).get();
                        count = countSnap.size;
                        migrated++;
                    } else {
                        missing++;
                    }
                } catch (e) {
                    missing++;
                }
                
                const isImportant = importantTables.includes(table);
                tableData.push({ table, status, count, isImportant });
            }

            document.getElementById('totalFirebase').textContent = migrated;
            document.getElementById('totalMissing').textContent = missing;
            document.getElementById('percentage').textContent = Math.round((migrated / mysqlTables.length) * 100) + '%';
            
            renderTable();
        }

        function renderTable() {
            const tbody = document.getElementById('tableBody');
            let filtered = tableData;
            
            if (currentFilter === 'migrated') {
                filtered = tableData.filter(t => t.status === 'migrated');
            } else if (currentFilter === 'missing') {
                filtered = tableData.filter(t => t.status === 'missing');
            } else if (currentFilter === 'important') {
                filtered = tableData.filter(t => t.isImportant);
            }
            
            tbody.innerHTML = filtered.map(t => `
                <tr class="${t.isImportant ? 'highlight' : ''}">
                    <td><strong>${t.table}</strong> ${t.isImportant ? '‚≠ê' : ''}</td>
                    <td class="status-${t.status}">${t.status === 'migrated' ? '‚úÖ Migrated' : '‚ùå Not Migrated'}</td>
                    <td>${t.count > 0 ? t.count.toLocaleString() : '-'}</td>
                    <td>${t.isImportant ? 'High' : 'Normal'}</td>
                </tr>
            `).join('');
        }

        function setFilter(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.toggle('active', btn.textContent.toLowerCase().includes(filter) || 
                    (filter === 'all' && btn.textContent === 'All'));
            });
            renderTable();
        }

        function filterTables(search) {
            const rows = document.querySelectorAll('#tableBody tr');
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(search.toLowerCase()) ? '' : 'none';
            });
        }

        // Start checking
        checkFirebaseTables();
    </script>
</body>
</html>
