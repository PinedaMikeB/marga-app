<!DOCTYPE html>
<html>
<head>
    <title>Check Categories</title>
    <style>
        body { font-family: system-ui; padding: 2rem; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background: #1e3a5f; color: white; }
    </style>
</head>
<body>
    <h1>Contract Categories</h1>
    <button onclick="loadCategories()">Load Categories</button>
    <div id="results"></div>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="shared/js/firebase-config.js"></script>
    <script>
        if (!firebase.apps.length) firebase.initializeApp(FIREBASE_CONFIG);
        const db = firebase.firestore();
        
        async function loadCategories() {
            // Check tbl_category
            const catSnap = await db.collection('tbl_category').get();
            const categories = catSnap.docs.map(d => ({id: d.id, ...d.data()}));
            
            // Check contracts for category_id distribution
            const contractSnap = await db.collection('tbl_contractmain').limit(500).get();
            const contracts = contractSnap.docs.map(d => d.data());
            
            const catCounts = {};
            contracts.forEach(c => {
                const catId = c.category_id || 'none';
                catCounts[catId] = (catCounts[catId] || 0) + 1;
            });
            
            document.getElementById('results').innerHTML = `
                <h2>Categories Table (${categories.length} records)</h2>
                <table>
                    <tr><th>ID</th><th>Code</th><th>Name</th><th>All Fields</th></tr>
                    ${categories.map(c => `
                        <tr>
                            <td>${c.id}</td>
                            <td>${c.particular_code || c.code || '-'}</td>
                            <td>${c.particular || c.name || '-'}</td>
                            <td><pre>${JSON.stringify(c, null, 2)}</pre></td>
                        </tr>
                    `).join('')}
                </table>
                
                <h2>Category Distribution in Contracts</h2>
                <table>
                    <tr><th>Category ID</th><th>Count</th></tr>
                    ${Object.entries(catCounts).sort((a,b) => b[1] - a[1]).map(([id, count]) => `
                        <tr><td>${id}</td><td>${count}</td></tr>
                    `).join('')}
                </table>
            `;
        }
    </script>
</body>
</html>
