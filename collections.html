<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collections - Marga Enterprises</title>
    <link rel="stylesheet" href="shared/css/styles.css">
    <link rel="stylesheet" href="shared/css/dashboard.css">
    <style>
        :root {
            --panel-bg: rgba(255, 255, 255, 0.86);
            --panel-border: rgba(255, 255, 255, 0.55);
            --panel-shadow: 0 10px 24px rgba(16, 24, 40, 0.12);
            --panel-shadow-soft: 0 5px 14px rgba(16, 24, 40, 0.08);
        }

        .main-content {
            padding: 24px;
        }

        .collections-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 14px;
            flex-wrap: wrap;
            margin-bottom: 14px;
            padding: 14px 16px;
            border-radius: 14px;
            background: var(--panel-bg);
            border: 1px solid var(--panel-border);
            box-shadow: var(--panel-shadow-soft);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .collections-title {
            display: flex;
            align-items: baseline;
            gap: 10px;
            flex-wrap: wrap;
        }

        .collections-header h1 {
            margin: 0;
            font-size: 31px;
            color: #183b63;
            line-height: 1;
        }

        #dataMode {
            font-size: 12px;
            color: #4e6a86;
            font-weight: 600;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        #last-updated {
            font-size: 11px;
            color: #486682;
            font-weight: 600;
        }

        .error-banner {
            margin-bottom: 12px;
            padding: 10px 12px;
            border-radius: 10px;
            background: rgba(239, 68, 68, 0.12);
            border: 1px solid rgba(239, 68, 68, 0.22);
            color: #b42318;
            font-size: 12px;
        }

        .error-banner.hidden {
            display: none;
        }

        .tip-banner {
            background: linear-gradient(120deg, rgba(239, 246, 255, 0.96) 0%, rgba(219, 234, 254, 0.94) 100%);
            border: 1px solid rgba(147, 197, 253, 0.75);
            border-radius: 12px;
            box-shadow: var(--panel-shadow-soft);
            padding: 12px 14px;
            margin-bottom: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #234c78;
        }

        .tip-banner .tip-icon {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: rgba(59, 130, 246, 0.16);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 700;
        }

        .tip-banner .tip-content {
            flex: 1;
        }

        .tip-banner .tip-text {
            font-size: 12px;
            font-weight: 600;
            color: #1f4f7a;
        }

        .tip-banner .tip-close {
            cursor: pointer;
            color: #2d5f90;
            font-size: 16px;
            font-weight: 700;
        }

        .priority-section {
            margin-bottom: 14px;
        }

        .priority-section h3 {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: #486682;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .priority-cards {
            display: grid;
            grid-template-columns: repeat(6, minmax(140px, 1fr));
            gap: 10px;
        }

        .priority-card {
            background: var(--panel-bg);
            border-radius: 12px;
            padding: 12px 12px;
            border: 1px solid var(--panel-border);
            box-shadow: var(--panel-shadow-soft);
            cursor: pointer;
            transition: transform 0.16s ease, box-shadow 0.16s ease, background 0.16s ease;
            border-top: 3px solid #b6c6d9;
        }

        .priority-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--panel-shadow);
        }

        .priority-card.active {
            background: rgba(219, 234, 254, 0.85);
        }

        .priority-card.urgent { border-top-color: #dc2626; }
        .priority-card.high { border-top-color: #f97316; }
        .priority-card.medium { border-top-color: #f59e0b; }
        .priority-card.current { border-top-color: #16a34a; }
        .priority-card.review { border-top-color: #7c3aed; }
        .priority-card.baddebt { border-top-color: #475569; }

        .priority-card .card-title {
            font-size: 12px;
            font-weight: 700;
            color: #1f3956;
            margin-bottom: 5px;
        }

        .priority-card .card-count {
            font-size: 28px;
            font-weight: 800;
            line-height: 1;
            color: #143e69;
            margin-bottom: 5px;
        }

        .priority-card .card-amount {
            font-size: 12px;
            color: #355d85;
            font-weight: 700;
        }

        .priority-card .card-hint {
            margin-top: 6px;
            font-size: 10px;
            color: #5a7390;
            line-height: 1.4;
            font-weight: 600;
        }

        .stats-row {
            display: grid;
            grid-template-columns: repeat(6, minmax(140px, 1fr));
            gap: 10px;
            margin-bottom: 14px;
        }

        .stat-card {
            border-radius: 12px;
            padding: 12px;
            background: var(--panel-bg);
            border: 1px solid var(--panel-border);
            box-shadow: var(--panel-shadow-soft);
        }

        .stat-card.primary {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.93) 0%, rgba(30, 73, 118, 0.95) 100%);
            color: #fff;
        }

        .stat-card.warning {
            border-left: 3px solid #f59e0b;
        }

        .stat-card.danger {
            border-left: 3px solid #ef4444;
        }

        .stat-card .label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: #5c7290;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-card .value {
            font-size: 28px;
            font-weight: 800;
            line-height: 1;
            color: #163c64;
        }

        .stat-card .subvalue {
            margin-top: 5px;
            font-size: 12px;
            color: #4f6f8f;
            font-weight: 700;
        }

        .stat-card.primary .label,
        .stat-card.primary .value,
        .stat-card.primary .subvalue {
            color: #fff;
        }

        .filters-section,
        .data-table-container {
            background: var(--panel-bg);
            border-radius: 12px;
            border: 1px solid var(--panel-border);
            box-shadow: var(--panel-shadow-soft);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            overflow: hidden;
        }

        .filters-section {
            margin-bottom: 14px;
            padding: 12px;
        }

        .quick-age-filters {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .quick-age-btn {
            border: 1px solid rgba(148, 163, 184, 0.28);
            background: rgba(255, 255, 255, 0.72);
            color: #36597c;
            border-radius: 18px;
            padding: 6px 12px;
            font-size: 11px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .quick-age-btn.active,
        .quick-age-btn:hover {
            color: #fff;
            border-color: rgba(37, 99, 235, 0.3);
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.9) 0%, rgba(30, 73, 118, 0.95) 100%);
        }

        .filters-row {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: flex-end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .filter-group label {
            font-size: 10px;
            color: #526f8d;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.06em;
        }

        .filters-row select,
        .filters-row input {
            padding: 7px 10px;
            border: 1px solid rgba(148, 163, 184, 0.32);
            border-radius: 8px;
            font-size: 12px;
            min-width: 100px;
            background: rgba(255, 255, 255, 0.88);
            color: #1f4268;
            font-weight: 600;
        }

        .filters-row select:focus,
        .filters-row input:focus {
            outline: none;
            border-color: rgba(37, 99, 235, 0.55);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.12);
        }

        .btn {
            font-size: 12px;
            font-weight: 700;
            padding: 7px 11px;
            border-radius: 9px;
            border: 1px solid transparent;
            transition: all 0.15s ease;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }

        .btn-sm {
            font-size: 11px;
            padding: 6px 10px;
            border-radius: 8px;
        }

        .btn-primary {
            color: #fff;
            border-color: rgba(30, 73, 118, 0.35);
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.94) 0%, rgba(30, 73, 118, 0.95) 100%);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 16px rgba(29, 78, 216, 0.24);
        }

        .btn-secondary {
            color: #2f567e;
            border-color: rgba(148, 163, 184, 0.3);
            background: rgba(255, 255, 255, 0.75);
        }

        .btn-secondary:hover {
            background: rgba(239, 246, 255, 0.95);
            border-color: rgba(96, 165, 250, 0.5);
        }

        .btn-success {
            color: #fff;
            border-color: rgba(5, 150, 105, 0.35);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.95) 0%, rgba(5, 150, 105, 0.95) 100%);
        }

        .btn-warning {
            color: #fff;
            border-color: rgba(194, 120, 3, 0.35);
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.95) 0%, rgba(217, 119, 6, 0.95) 100%);
        }

        .btn.active {
            color: #fff;
            border-color: rgba(30, 73, 118, 0.3);
            background: linear-gradient(135deg, rgba(30, 73, 118, 0.92) 0%, rgba(15, 37, 60, 0.94) 100%);
        }

        .followup-btn {
            position: relative;
        }

        .followup-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ef4444;
            color: #fff;
            font-size: 10px;
            font-weight: 800;
            line-height: 1;
            border-radius: 999px;
            padding: 4px 7px;
            display: none;
        }

        .active-filters {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        .filter-tag {
            background: rgba(219, 234, 254, 0.78);
            color: #1e4d7b;
            border: 1px solid rgba(147, 197, 253, 0.7);
            padding: 3px 8px;
            border-radius: 999px;
            font-size: 10px;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .filter-tag .remove {
            font-weight: 800;
            cursor: pointer;
            opacity: 0.75;
        }

        .report-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 10px;
            margin-bottom: 14px;
        }

        .report-panel-title {
            padding: 10px 12px;
            border-bottom: 1px solid rgba(148, 163, 184, 0.24);
            font-size: 12px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: #355879;
            background: rgba(239, 246, 255, 0.72);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            background: rgba(239, 246, 255, 0.92);
            padding: 10px 11px;
            text-align: left;
            font-weight: 800;
            font-size: 11px;
            color: #36587b;
            border-bottom: 1px solid rgba(148, 163, 184, 0.2);
            text-transform: uppercase;
            letter-spacing: 0.06em;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .data-table td {
            padding: 8px 11px;
            border-bottom: 1px solid rgba(148, 163, 184, 0.15);
            font-size: 12px;
            color: #1e3f61;
            font-weight: 600;
            vertical-align: top;
        }

        .data-table tr:hover {
            background: rgba(239, 246, 255, 0.75);
            cursor: pointer;
        }

        .data-table tr.has-followup {
            background: rgba(255, 251, 235, 0.72);
        }

        .data-table tr.has-followup:hover {
            background: rgba(254, 243, 199, 0.82);
        }

        .mini-table th,
        .mini-table td {
            font-size: 11px;
            padding: 7px 9px;
        }

        .amount {
            font-weight: 800;
            color: #b42318;
            white-space: nowrap;
        }

        .company-name {
            font-size: 12px;
            font-weight: 800;
            color: #173d63;
        }

        .branch-name {
            font-size: 11px;
            color: #4f6986;
            font-weight: 600;
        }

        .priority-badge {
            display: inline-flex;
            align-items: center;
            border-radius: 999px;
            padding: 2px 8px;
            font-size: 10px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            border: 1px solid transparent;
        }

        .priority-badge.urgent { background: rgba(254, 226, 226, 0.9); color: #b42318; border-color: rgba(252, 165, 165, 0.5); }
        .priority-badge.high { background: rgba(255, 237, 213, 0.9); color: #9a3412; border-color: rgba(253, 186, 116, 0.5); }
        .priority-badge.medium { background: rgba(254, 249, 195, 0.9); color: #854d0e; border-color: rgba(253, 224, 71, 0.5); }
        .priority-badge.current { background: rgba(220, 252, 231, 0.9); color: #166534; border-color: rgba(134, 239, 172, 0.5); }
        .priority-badge.review { background: rgba(243, 232, 255, 0.9); color: #5b21b6; border-color: rgba(196, 181, 253, 0.5); }
        .priority-badge.doubtful { background: rgba(250, 232, 255, 0.9); color: #86198f; border-color: rgba(233, 213, 255, 0.5); }
        .priority-badge.baddebt { background: rgba(226, 232, 240, 0.9); color: #334155; border-color: rgba(203, 213, 225, 0.5); }

        .age-current { color: #15803d; }
        .age-30 { color: #4d7c0f; }
        .age-60 { color: #a16207; }
        .age-90 { color: #c2410c; font-weight: 700; }
        .age-120 { color: #b91c1c; font-weight: 700; }
        .age-180 { color: #9f1239; font-weight: 700; }
        .age-365 { color: #6d28d9; font-weight: 700; }

        .loading-overlay {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 56px 18px;
            color: #3b5a7b;
            font-size: 13px;
            font-weight: 700;
        }

        .loading-spinner {
            width: 26px;
            height: 26px;
            border-radius: 50%;
            border: 3px solid rgba(147, 197, 253, 0.45);
            border-top-color: rgba(37, 99, 235, 0.95);
            animation: spin 0.7s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .empty-state,
        .empty-followup {
            text-align: center;
            padding: 30px 18px;
            color: #4f6b88;
            font-size: 12px;
            font-weight: 700;
        }

        .table-scroll {
            max-height: calc(100vh - 440px);
            overflow-y: auto;
        }

        .pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
            padding: 10px 12px;
            border-top: 1px solid rgba(148, 163, 184, 0.2);
            background: rgba(239, 246, 255, 0.64);
        }

        .pagination-info {
            font-size: 11px;
            color: #4d6a88;
            font-weight: 700;
        }

        .pagination-buttons {
            display: flex;
            gap: 6px;
        }

        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.52);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
        }

        .modal-overlay.hidden {
            display: none;
        }

        .modal {
            width: min(780px, 96vw);
            max-height: 84vh;
            overflow: auto;
            border-radius: 14px;
            background: #fff;
            box-shadow: 0 22px 60px rgba(15, 23, 42, 0.42);
        }

        .modal.modal-lg {
            width: min(980px, 96vw);
        }

        .modal-header {
            padding: 14px 18px;
            border-bottom: 1px solid rgba(148, 163, 184, 0.2);
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.93) 0%, rgba(30, 73, 118, 0.94) 100%);
            color: #fff;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 24px;
            line-height: 1.1;
            letter-spacing: -0.01em;
        }

        .modal-header p {
            margin: 4px 0 0;
            font-size: 12px;
            opacity: 0.9;
            font-weight: 600;
        }

        .modal-body {
            padding: 16px 18px;
        }

        .modal-footer {
            padding: 10px 18px;
            border-top: 1px solid rgba(148, 163, 184, 0.22);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
            background: rgba(239, 246, 255, 0.42);
        }

        .checkbox-row {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: #385f84;
            font-weight: 700;
        }

        .brief-section {
            margin-bottom: 14px;
        }

        .brief-section h4 {
            margin: 0 0 8px;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: #375c80;
        }

        .brief-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 8px;
        }

        .brief-item {
            border: 1px solid rgba(148, 163, 184, 0.22);
            border-radius: 10px;
            padding: 10px;
            background: rgba(248, 250, 252, 0.8);
        }

        .brief-item .kicker {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.07em;
            color: #5c7591;
            font-weight: 800;
            margin-bottom: 3px;
        }

        .brief-item .metric {
            font-size: 22px;
            line-height: 1;
            font-weight: 800;
            color: #183d64;
            margin-bottom: 4px;
        }

        .brief-item .meta {
            font-size: 11px;
            color: #426489;
            font-weight: 700;
        }

        .brief-item.alert {
            background: rgba(254, 242, 242, 0.85);
            border-color: rgba(252, 165, 165, 0.45);
        }

        .brief-item.warning {
            background: rgba(255, 251, 235, 0.9);
            border-color: rgba(253, 230, 138, 0.55);
        }

        .brief-item .metric.alert {
            color: #b42318;
        }

        .brief-item .metric.warning {
            color: #9a3412;
        }

        .followup-list {
            max-height: 300px;
            overflow-y: auto;
            display: grid;
            gap: 8px;
        }

        .followup-item {
            background: #fff;
            border-radius: 10px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.15s ease;
            border: 1px solid rgba(148, 163, 184, 0.22);
        }

        .followup-item:hover {
            border-color: rgba(59, 130, 246, 0.45);
            background: rgba(239, 246, 255, 0.85);
        }

        .followup-company {
            font-size: 13px;
            font-weight: 800;
            color: #1a3f65;
            margin-bottom: 3px;
        }

        .followup-invoice {
            font-size: 11px;
            color: #4f6f8f;
            font-weight: 600;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 8px;
            margin-bottom: 14px;
        }

        .detail-item {
            background: rgba(239, 246, 255, 0.68);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 10px;
            padding: 9px 10px;
        }

        .detail-item label {
            display: block;
            margin-bottom: 3px;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: #587291;
            font-weight: 700;
        }

        .detail-item span {
            color: #12385d;
            font-size: 13px;
            font-weight: 800;
        }

        .detail-last-remark {
            margin-bottom: 14px;
            border-radius: 10px;
            border: 1px solid rgba(251, 191, 36, 0.45);
            background: rgba(255, 251, 235, 0.88);
            padding: 10px;
        }

        .detail-last-remark h4 {
            margin: 0 0 4px;
            font-size: 11px;
            color: #92400e;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .detail-last-remark p {
            margin: 0;
            font-size: 12px;
            color: #4f2f05;
            font-weight: 700;
        }

        .history-section h4 {
            margin: 0 0 8px;
            font-size: 12px;
            color: #345b82;
            text-transform: uppercase;
            letter-spacing: 0.06em;
        }

        .history-list {
            max-height: 280px;
            overflow-y: auto;
        }

        .history-item {
            border: 1px solid rgba(147, 197, 253, 0.55);
            background: rgba(239, 246, 255, 0.72);
            border-radius: 10px;
            padding: 9px 10px;
            margin-bottom: 8px;
        }

        .history-date {
            font-size: 10px;
            color: #4f6c89;
            font-weight: 700;
            margin-bottom: 3px;
        }

        .history-remarks {
            font-size: 12px;
            color: #173d62;
            font-weight: 700;
        }

        .history-followup {
            margin-top: 4px;
            font-size: 11px;
            color: #7c2d12;
            font-weight: 700;
        }

        .no-history {
            text-align: center;
            padding: 18px;
            font-size: 12px;
            color: #5f7693;
            font-weight: 700;
        }

        @media (max-width: 1300px) {
            .priority-cards,
            .stats-row {
                grid-template-columns: repeat(3, minmax(140px, 1fr));
            }
        }

        @media (max-width: 1024px) {
            .report-grid {
                grid-template-columns: 1fr;
            }

            .table-scroll {
                max-height: none;
            }
        }

        @media (max-width: 900px) {
            .main-content {
                padding: 14px;
            }

            .priority-cards,
            .stats-row,
            .brief-grid,
            .detail-grid {
                grid-template-columns: 1fr;
            }

            .collections-header h1 {
                font-size: 26px;
            }

            .header-actions {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="modal-overlay" id="welcomeModal">
        <div class="modal">
            <div class="modal-header">
                <h2>Today's Action Brief</h2>
                <p>Collector-first queue for immediate work and reminders</p>
            </div>
            <div class="modal-body">
                <div class="brief-section">
                    <h4>Priority Queue</h4>
                    <div class="brief-grid">
                        <div class="brief-item">
                            <div class="kicker">Scheduled Follow-ups</div>
                            <div class="metric" id="brief-scheduled-count">0</div>
                            <div class="meta" id="brief-scheduled-amount">Amount: P0</div>
                        </div>
                        <div class="brief-item warning">
                            <div class="kicker">Promise Due Today</div>
                            <div class="metric warning" id="brief-promises-count">0</div>
                            <div class="meta" id="brief-promises-amount">Amount: P0</div>
                        </div>
                        <div class="brief-item alert">
                            <div class="kicker">Urgent 20+ Days No Call</div>
                            <div class="metric alert" id="brief-urgent-stale-count">0</div>
                            <div class="meta" id="brief-urgent-stale-amount">Amount: P0</div>
                        </div>
                        <div class="brief-item warning">
                            <div class="kicker">High Value Due in 7 Days</div>
                            <div class="metric warning" id="brief-high-value-count">0</div>
                            <div class="meta" id="brief-high-value-amount">Amount: P0</div>
                        </div>
                    </div>
                </div>

                <div class="brief-section">
                    <h4>Data Quality Reminder</h4>
                    <div class="brief-grid">
                        <div class="brief-item alert">
                            <div class="kicker">Missing Contact / No Call Log</div>
                            <div class="metric alert" id="brief-missing-contact-count">0</div>
                            <div class="meta">Update contact person and remarks before next call cycle.</div>
                        </div>
                        <div class="brief-item">
                            <div class="kicker">Quick Focus</div>
                            <div class="meta">1) Promise Due Today 2) Urgent 91-120 days 3) High-value invoices this week.</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <label class="checkbox-row"><input type="checkbox" id="dontShowAgain"> Do not show on startup</label>
                <button class="btn btn-primary" onclick="closeWelcomeModal()">Start Queue</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay hidden" id="followupModal">
        <div class="modal">
            <div class="modal-header">
                <h2>Today's Scheduled Collection</h2>
                <p>Follow-ups scheduled for today</p>
            </div>
            <div class="modal-body">
                <div id="followupList"></div>
            </div>
            <div class="modal-footer">
                <span></span>
                <button class="btn btn-secondary" onclick="closeFollowupModal()">Close</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay hidden" id="detailModal">
        <div class="modal modal-lg">
            <div class="modal-header">
                <h2>Invoice #<span id="detailInvoiceNo"></span></h2>
                <p>Invoice details and collection follow-up history</p>
            </div>
            <div class="modal-body" id="detailContent"></div>
            <div class="modal-footer">
                <span></span>
                <button class="btn btn-primary" onclick="closeDetailModal()">Close</button>
            </div>
        </div>
    </div>

    <div class="dashboard-container">
        <aside class="sidebar">
            <div class="sidebar-header"><h2>MARGA</h2><span class="subtitle">Enterprise System</span></div>
            <nav class="sidebar-nav">
                <a href="dashboard.html" class="nav-item"><span class="icon">ðŸ“Š</span> Dashboard</a>
                <a href="customers.html" class="nav-item"><span class="icon">ðŸ‘¥</span> Customers</a>
                <a href="billing.html" class="nav-item"><span class="icon">ðŸ“„</span> Billing</a>
                <a href="collections.html" class="nav-item active"><span class="icon">ðŸ’°</span> Collections</a>
                <a href="#" class="nav-item"><span class="icon">ðŸ”§</span> Service</a>
                <a href="#" class="nav-item"><span class="icon">ðŸ“ˆ</span> Reports</a>
            </nav>
            <div class="sidebar-footer"><span id="current-user">Collector</span><a href="index.html" class="logout-btn">Logout</a></div>
        </aside>

        <main class="main-content">
            <div class="collections-header">
                <div class="collections-title">
                    <h1>Collections</h1>
                    <span id="dataMode">(Active 0-180 days)</span>
                </div>
                <div class="header-actions">
                    <button class="btn btn-warning btn-sm followup-btn" onclick="showTodayFollowups()">Today's Follow-ups <span class="followup-badge" id="followupBadge">0</span></button>
                    <button class="btn btn-secondary btn-sm" onclick="showWelcomeModal()">Today's Brief</button>
                    <button class="btn btn-secondary btn-sm" id="btnShowBadDebt" onclick="toggleBadDebt()">Bad Debt</button>
                    <span id="last-updated"></span>
                    <button class="btn btn-primary btn-sm" onclick="loadUnpaidInvoices()">Refresh</button>
                </div>
            </div>

            <div class="error-banner hidden" id="errorBanner"></div>

            <div class="tip-banner" id="tipBanner">
                <span class="tip-icon">i</span>
                <div class="tip-content"><div class="tip-text" id="tipText"></div></div>
                <span class="tip-close" onclick="closeTip()">x</span>
            </div>

            <div class="priority-section">
                <h3>Priority Buckets</h3>
                <div class="priority-cards">
                    <div class="priority-card urgent" onclick="filterByPriority('urgent')">
                        <div class="card-title">Urgent</div>
                        <div class="card-count" id="count-urgent">0</div>
                        <div class="card-amount" id="amount-urgent">P0</div>
                        <div class="card-hint">91-120 days: call now</div>
                    </div>
                    <div class="priority-card high" onclick="filterByPriority('high')">
                        <div class="card-title">High</div>
                        <div class="card-count" id="count-high">0</div>
                        <div class="card-amount" id="amount-high">P0</div>
                        <div class="card-hint">61-90 days: aggressive follow-up</div>
                    </div>
                    <div class="priority-card medium" onclick="filterByPriority('medium')">
                        <div class="card-title">Medium</div>
                        <div class="card-count" id="count-medium">0</div>
                        <div class="card-amount" id="amount-medium">P0</div>
                        <div class="card-hint">31-60 days: reminders</div>
                    </div>
                    <div class="priority-card current" onclick="filterByPriority('current')">
                        <div class="card-title">Current</div>
                        <div class="card-count" id="count-current">0</div>
                        <div class="card-amount" id="amount-current">P0</div>
                        <div class="card-hint">0-30 days: standard follow-up</div>
                    </div>
                    <div class="priority-card review" onclick="filterByPriority('review')">
                        <div class="card-title">For Review</div>
                        <div class="card-count" id="count-review">0</div>
                        <div class="card-amount" id="amount-review">P0</div>
                        <div class="card-hint">121-365 days: management review</div>
                    </div>
                    <div class="priority-card baddebt" onclick="filterByPriority('baddebt')">
                        <div class="card-title">Bad Debt</div>
                        <div class="card-count" id="count-baddebt">0</div>
                        <div class="card-amount" id="amount-baddebt">P0</div>
                        <div class="card-hint">365+ days: write-off candidate</div>
                    </div>
                </div>
            </div>

            <div class="stats-row">
                <div class="stat-card primary">
                    <div class="label">Total Receivables</div>
                    <div class="value" id="total-unpaid">P0</div>
                </div>
                <div class="stat-card">
                    <div class="label">Active <=120D</div>
                    <div class="value" id="total-active">P0</div>
                </div>
                <div class="stat-card">
                    <div class="label">Filtered Invoices</div>
                    <div class="value" id="invoice-count">0</div>
                </div>
                <div class="stat-card">
                    <div class="label">Collectible</div>
                    <div class="value" id="collectible-count">0</div>
                </div>
                <div class="stat-card warning">
                    <div class="label">Scheduled Today</div>
                    <div class="value" id="scheduled-count">0</div>
                    <div class="subvalue" id="scheduled-amount">P0</div>
                </div>
                <div class="stat-card danger">
                    <div class="label">Urgent 20+ Days No Call</div>
                    <div class="value" id="stale-urgent-count">0</div>
                    <div class="subvalue" id="stale-urgent-amount">P0</div>
                </div>
            </div>

            <div class="filters-section">
                <div class="quick-age-filters">
                    <button class="quick-age-btn active" data-bucket="all">All</button>
                    <button class="quick-age-btn" data-bucket="30">30 days up</button>
                    <button class="quick-age-btn" data-bucket="60">60 days up</button>
                    <button class="quick-age-btn" data-bucket="90">90 days up</button>
                    <button class="quick-age-btn" data-bucket="120">120 days up</button>
                </div>

                <div class="filters-row">
                    <div class="filter-group"><label>Year</label><select id="filter-year"><option value="">All</option></select></div>
                    <div class="filter-group"><label>Month</label><select id="filter-month"><option value="">All</option><option>January</option><option>February</option><option>March</option><option>April</option><option>May</option><option>June</option><option>July</option><option>August</option><option>September</option><option>October</option><option>November</option><option>December</option></select></div>
                    <div class="filter-group"><label>Age Range</label><select id="filter-age"><option value="">All</option><option value="0-30">0-30d</option><option value="31-60">31-60d</option><option value="61-90">61-90d</option><option value="91-120">91-120d</option><option value="121-180">121-180d</option><option value="181-365">181-365d</option><option value="366+">1yr+</option></select></div>
                    <div class="filter-group"><label>Category</label><select id="filter-category"><option value="">All</option><option>RTP</option><option>RTF</option><option>MAP</option></select></div>
                    <div class="filter-group"><label>From Date</label><input type="date" id="filter-from-date"></div>
                    <div class="filter-group"><label>To Date</label><input type="date" id="filter-to-date"></div>
                    <div class="filter-group"><label>Search</label><input type="text" id="search-input" placeholder="Company / Invoice" style="width:150px;"></div>
                    <button class="btn btn-primary btn-sm" onclick="applyFilters()">Filter</button>
                    <button class="btn btn-secondary btn-sm" onclick="clearFilters()">Clear</button>
                    <button class="btn btn-success btn-sm" onclick="exportToExcel()">Export</button>
                </div>
                <div class="active-filters" id="active-filters"></div>
            </div>

            <div class="report-grid">
                <div class="data-table-container">
                    <div class="report-panel-title">Scheduled Collection Today</div>
                    <div id="today-schedule-table"><div class="empty-followup">Loading scheduled collection...</div></div>
                </div>
                <div class="data-table-container">
                    <div class="report-panel-title">Promise Due Today</div>
                    <div id="promise-due-table"><div class="empty-followup">Loading promise-due accounts...</div></div>
                </div>
                <div class="data-table-container">
                    <div class="report-panel-title">Urgent Accounts Not Called 20+ Days</div>
                    <div id="urgent-stale-table"><div class="empty-followup">Loading urgent list...</div></div>
                </div>
                <div class="data-table-container">
                    <div class="report-panel-title">Missing Contact or No Call Log</div>
                    <div id="missing-contact-table"><div class="empty-followup">Loading data quality queue...</div></div>
                </div>
            </div>

            <div class="data-table-container">
                <div class="report-panel-title">Collector Work Queue</div>
                <div class="table-scroll" id="table-container"><div class="loading-overlay"><div class="loading-spinner"></div><span>Loading...</span></div></div>
                <div class="pagination" id="pagination" style="display:none;">
                    <div class="pagination-info">Showing <span id="showing-start">0</span>-<span id="showing-end">0</span> of <span id="total-records">0</span></div>
                    <div class="pagination-buttons">
                        <button class="btn btn-secondary btn-sm" onclick="prevPage()" id="btn-prev">Prev</button>
                        <button class="btn btn-secondary btn-sm" onclick="nextPage()" id="btn-next">Next</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="shared/js/firebase-config.js"></script>
    <script src="collections/js/collections.js"></script>
</body>
</html>
